<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body body class="m-0 vh-100 col justify-content-left align-items-top">
    <div class="container justify-content-left">
        <div class="forma2">
            <div class="d-inline-flex  align-items-center p-2 .bg-light">
                <h2>Gestión de métricas vROps</h2>
            </div><br/>


            <div class="container col-auto">
                <div class="d-inline-flex justify-content-start align-items-center p-2 .bg-light">
                    <div class="border border-secondary p-3 mb-2 bg-light text-dark rounded">
                    <div id="loader" class="loader" style="display:none;"></div>
        
                        <form id="enviarForma" action="../genStats.php" method="post" class="form-group">

                            

                            <div id="server" class="form-group form-check-inline"><h5> Super servidor - Pag de prueba<br/></h5>'; 
                            <label for="server" id="labelServer" style="cursor:pointer">Cambiar servidor-></label>';
                                
                            </div><br/><br/>

                            <div class="form-group form-check-inline"><h5>Fecha del lapso <br/></h5>               
                                <label for="mesConsulta">Mes a obtener</label>    
                                <input type="month" id="mesConsulta" name="mesConsulta"><div id="alertaFecha" style="visibility:hidden; color:red">La fecha a consultar no puede ser anterior a seis meses ni igual o posterior a la actual</div>                                            
                            </div><br/><br/>

                            <div class="form-group form-check-inline"><h5>Intervalo de medición</h5>
                                <label for="HOURS">Horas</label>
                                <input type="radio" id="HOURS" name="intervalType" value="HOURS" checked>
                                <label for="MINUTES">Minutos</label>
                                <input type="radio" id="MINUTES" name="intervalType" value="MINUTES">
                            </div><br/><br/>

                            <div class="form-group form-check-inline"><h5>Cuantificador del intervalo</h5>
                                <label for="intervalQuantifier">Tipo de Intervalo</label>
                                <input type="number" id="intervalQuantifier" name="intervalQuantifier" min="1" max="12" value="1">
                            </div><br/><br/>

                            <div class="form-group form-check-inline"><h5>Tipo de intervalo</h5>
                                <label for="AVG">AVG</label>
                                <input type="radio" id="AVG" name="rollUpType" value="AVG" autofocus checked></br>               
                            </div><br/><br/>

                            <div class="form-group form-check-inline"><h5>Tipo de Recurso</h5>
                                <input type="checkbox" id="virtualmachine" name="virtualmachine" value="resourceKinds" checked>
                                <label for="virtualmachine">Virtual Machine</label>
                                <input type="checkbox" id="hostsystem" name="hostsystem" value="resourceKinds" checked>
                                <label for="hostsystem">Hostsystem</label>     
                            </div><br/><br/>
                            <div><button type="submit"  class="btn btn-primary" id="enviarForma" disabled onclick="enviar()">Enviar</button></div>          

                        </form><br/><br/>      
                    </div>
                </div>
            </div>
        </div>
    </div>
    
<script text/javascript>     

    
    const topeMeses = 6;
    const mesConsulta =  document.getElementById("mesConsulta");
    mesConsulta.addEventListener('keypress', habilitar);        
    mesConsulta.addEventListener('change', habilitar);
    mesConsulta.addEventListener('change', rangoFechaOk);

    function rangoFechaOk(){        
        
        const fecha = mesConsulta.value;
                    
        const año = parseInt(fecha.substring(0, 4));
        const mes = parseInt(fecha.substring(5));

        fechaActual = new Date();

        mesActual =  fechaActual.getMonth() + 1; //se suma 1 porque enero comienza en 0 para la función
        añoActual = fechaActual.getFullYear();

        //--------------------------------------------------------------------
        //Compensa el número de meses de diferencia entre mes y mes actual
        
        if((añoActual - año < 0) || (añoActual - año > 1)) return false;            
        
        if(añoActual - año == 1) mesActual += 12; 
        
        //--------------------------------------------------------------------
        //Daddo que los meses están acomodados, se puede hacer el siguiente cálculo
        if (mesActual-mes>0 && mesActual-mes<=topeMeses) return true;
        
        //regresa falso si no se cumple ninguna de las anteriores
        return false;            
    }

    function habilitar(){                    
            const mesOk = mesConsulta.disabled == "" ? true : false;
            const fechaOk = rangoFechaOk() 
            const todoBien = mesOk && fechaOk;
            document.getElementById("enviarForma").enable= todoBien;
            if(fechaOk){
                document.getElementById("alertaFecha").style.visibility="hidden";
            }else{
                document.getElementById("alertaFecha").style.visibility="visible";
            }
    }

    
    function enviar(){                                
        document.getElementById("loader").style.visibility= "visible"; 
        document.getElementById("loader").style.display= "block";
        document.getElementById('enviarForma').submit();
    }            

    document.getElementById("server").addEventListener("click", function(){
       
        location.href = "/STISCR/vROps/view/ingreso.php";            
        
    })
    

</script>
<?php include_once '../../view/bodyScripts.php';?>
</body>
</html>
    
</body>
</html>